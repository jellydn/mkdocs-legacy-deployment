<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://typeorm-legacy.productsway.com/custom-repository/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Custom repositories - TypeORM 0.2.38</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Custom repositories";
        var mkdocs_page_input_path = "custom-repository.md";
        var mkdocs_page_url = "/custom-repository/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> TypeORM 0.2.38
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Documentation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../active-record-data-mapper/">Active Record vs Data Mapper</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../caching/">Caching queries</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../connection-api/">Connection APIs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../connection-options/">Connection Options</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../connection/">Working with Connection</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Custom repositories</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#custom-repository-extends-standard-repository">Custom repository extends standard Repository</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#custom-repository-extends-standard-abstractrepository">Custom repository extends standard AbstractRepository</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#custom-repository-without-extends">Custom repository without extends</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-custom-repositories-in-transactions-or-why-custom-repositories-cannot-be-services">Using custom repositories in transactions or why custom repositories cannot be services</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../decorator-reference/">Decorators reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../delete-query-builder/">Delete using Query Builder</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../eager-and-lazy-relations/">Eager and Lazy Relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../embedded-entities/">Embedded Entities</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../entities/">Entities</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../entity-inheritance/">Entity Inheritance</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../entity-manager-api/">`EntityManager` API</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../entity-metadata/">Entity Metadata</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../example-with-express/">Example using TypeORM with Express</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../find-options/">Find Options</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../indices/">Indices</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../insert-query-builder/">Insert using Query Builder</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../internals/">Internals</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../listeners-and-subscribers/">Entity Listeners and Subscribers</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logging/">Logging</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../many-to-many-relations/">Many-to-many relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../many-to-one-one-to-many-relations/">Many-to-one / one-to-many relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../migrations/">Migrations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../mongodb/">MongoDB</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../multiple-connections/">Multiple connections, databases, schemas and replication setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../naming-strategy/">Naming strategy</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../one-to-one-relations/">One-to-one relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../query-runner/">Working with Query Runner</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../relational-query-builder/">Working with Relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../relations-faq/">Relations FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../relations/">Relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../repository-api/">Repository APIs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../roadmap/">Roadmap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../select-query-builder/">Select using Query Builder</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../separating-entity-definition/">Separating Entity Definition</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../sequelize-migration/">Migration from Sequelize to TypeORM</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../support/">Support</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../supported-platforms/">Supported platforms</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../transactions/">Transactions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tree-entities/">Tree Entities</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../update-query-builder/">Update using Query Builder</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../usage-with-javascript/">Using with JavaScript</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../using-cli/">Using CLI</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../using-ormconfig/">Using Configuration Sources</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../validation/">Using Validation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../view-entities/">View Entities</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../working-with-entity-manager/">What is EntityManager</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../working-with-repository/">What is Repository</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">TypeORM 0.2.38</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>Custom repositories</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="custom-repositories">Custom repositories</h1>
<p>You can create a custom repository which should contain methods to work with your database.
Usually custom repositories are created for a single entity and contains its specific queries.
For example, let's say we want to have a method called <code>findByName(firstName: string, lastName: string)</code>
which will search for users by a given first and last names. 
The best place for this method is in <code>Repository</code>,
so we could call it like <code>userRepository.findByName(...)</code>.
You can achieve this using custom repositories.</p>
<p>There are several ways how custom repositories can be created.</p>
<ul>
<li><a href="#custom-repository-extends-standard-repository">Custom repository extends standard Repository</a> </li>
<li><a href="#custom-repository-extends-standard-abstractrepository">Custom repository extends standard AbstractRepository</a> </li>
<li><a href="#custom-repository-without-extends">Custom repository without extends</a></li>
<li><a href="#using-custom-repositories-in-transactions-or-why-custom-repositories-cannot-be-services">Using custom repositories in transactions</a></li>
</ul>
<h2 id="custom-repository-extends-standard-repository">Custom repository extends standard Repository</h2>
<p>The first way to create a custom repository is to extend <code>Repository</code>.
Example:</p>
<pre><code class="language-typescript">import {EntityRepository, Repository} from &quot;typeorm&quot;;
import {User} from &quot;../entity/User&quot;;

@EntityRepository(User)
export class UserRepository extends Repository&lt;User&gt; {

    findByName(firstName: string, lastName: string) {
        return this.findOne({ firstName, lastName });
    }

}
</code></pre>
<p>Then you can use it this way:</p>
<pre><code class="language-typescript">import {getCustomRepository} from &quot;typeorm&quot;;
import {UserRepository} from &quot;./repository/UserRepository&quot;;

const userRepository = getCustomRepository(UserRepository); // or connection.getCustomRepository or manager.getCustomRepository()
const user = userRepository.create(); // same as const user = new User();
user.firstName = &quot;Timber&quot;;
user.lastName = &quot;Saw&quot;;
await userRepository.save(user);

const timber = await userRepository.findByName(&quot;Timber&quot;, &quot;Saw&quot;);
</code></pre>
<p>As you can see you can "get" the repository using <code>getCustomRepository</code>
and you can access any method created inside it and any method in the standard entity repository.</p>
<h2 id="custom-repository-extends-standard-abstractrepository">Custom repository extends standard AbstractRepository</h2>
<p>The second way to create a custom repository is to extend <code>AbstractRepository</code>:</p>
<pre><code class="language-typescript">import {EntityRepository, AbstractRepository} from &quot;typeorm&quot;;
import {User} from &quot;../entity/User&quot;;

@EntityRepository(User)
export class UserRepository extends AbstractRepository&lt;User&gt; {

    createAndSave(firstName: string, lastName: string) {
        const user = new User();
        user.firstName = firstName;
        user.lastName = lastName;
        return this.manager.save(user);
    }

    findByName(firstName: string, lastName: string) {
        return this.repository.findOne({ firstName, lastName });
    }

}
</code></pre>
<p>Then you can use it this way:</p>
<pre><code class="language-typescript">import {getCustomRepository} from &quot;typeorm&quot;;
import {UserRepository} from &quot;./repository/UserRepository&quot;;

const userRepository = getCustomRepository(UserRepository); // or connection.getCustomRepository or manager.getCustomRepository()
await userRepository.createAndSave(&quot;Timber&quot;, &quot;Saw&quot;);
const timber = await userRepository.findByName(&quot;Timber&quot;, &quot;Saw&quot;);
</code></pre>
<p>The difference between this type of repository and the previous one is that it does not expose all the methods <code>Repository</code> has.
<code>AbstractRepository</code> does not have any public methods, 
it only has protected methods, like <code>manager</code> and <code>repository</code>, which you can use in your own
public methods.
Extending <code>AbstractRepository</code> is useful if you don't want to expose all methods the standard <code>Repository</code> has to the public.</p>
<h2 id="custom-repository-without-extends">Custom repository without extends</h2>
<p>The third way to create a repository is to not extend anything, 
but define a constructor which always accepts an entity manager instance:</p>
<pre><code class="language-typescript">import {EntityRepository, Repository, EntityManager} from &quot;typeorm&quot;;
import {User} from &quot;../entity/User&quot;;

@EntityRepository()
export class UserRepository {

    constructor(private manager: EntityManager) {
    }

    createAndSave(firstName: string, lastName: string) {
        const user = new User();
        user.firstName = firstName;
        user.lastName = lastName;
        return this.manager.save(user);
    }

    findByName(firstName: string, lastName: string) {
        return this.manager.findOne(User, { firstName, lastName });
    }

}
</code></pre>
<p>Then you can use it this way:</p>
<pre><code class="language-typescript">import {getCustomRepository} from &quot;typeorm&quot;;
import {UserRepository} from &quot;./repository/UserRepository&quot;;

const userRepository = getCustomRepository(UserRepository); // or connection.getCustomRepository or manager.getCustomRepository()
await userRepository.createAndSave(&quot;Timber&quot;, &quot;Saw&quot;);
const timber = await userRepository.findByName(&quot;Timber&quot;, &quot;Saw&quot;);
</code></pre>
<p>This type of repository does not extend anything - you only need to define a constructor
which must accept <code>EntityManager</code>. Then you can use it everywhere in your repository methods.
Also, this type of repository is not bound to a specific entity,
thus, you can operate with multiple entities inside them. </p>
<h2 id="using-custom-repositories-in-transactions-or-why-custom-repositories-cannot-be-services">Using custom repositories in transactions or why custom repositories cannot be services</h2>
<p>Custom repositories cannot be services, 
because there isn't a single instance of a custom repository (just like regular repositories or entity manager) in the app.
Besides the fact that there can be multiple connections in your app (where entity manager and repositories are different)
repositories and managers are different in transactions as well. 
For example:</p>
<pre><code class="language-typescript">await connection.transaction(async manager =&gt; {
    // in transactions you MUST use manager instance provided by a transaction,
    // you cannot use global managers, repositories or custom repositories
    // because this manager is exclusive and transactional
    // and if let's say we would do custom repository as a service
    // it has a &quot;manager&quot; property which should be unique instance of EntityManager
    // but there is no global EntityManager instance and cannot be
    // thats why custom managers are specific to each EntityManager and cannot be services.
    // this also opens opportunity to use custom repositories in transactions without any issues:

    const userRepository = manager.getCustomRepository(UserRepository); // DONT USE GLOBAL getCustomRepository here!
    await userRepository.createAndSave(&quot;Timber&quot;, &quot;Saw&quot;);
    const timber = await userRepository.findByName(&quot;Timber&quot;, &quot;Saw&quot;);
});
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../connection/" class="btn btn-neutral float-left" title="Working with Connection"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../decorator-reference/" class="btn btn-neutral float-right" title="Decorators reference">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../connection/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../decorator-reference/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
