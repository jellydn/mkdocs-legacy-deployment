<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://typeorm-legacy.productsway.com/repository-api/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Repository APIs - TypeORM 0.2.38</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Repository APIs";
        var mkdocs_page_input_path = "repository-api.md";
        var mkdocs_page_url = "/repository-api/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> TypeORM 0.2.38
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Documentation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../active-record-data-mapper/">Active Record vs Data Mapper</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../caching/">Caching queries</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../connection-api/">Connection APIs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../connection-options/">Connection Options</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../connection/">Working with Connection</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../custom-repository/">Custom repositories</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../decorator-reference/">Decorators reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../delete-query-builder/">Delete using Query Builder</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../eager-and-lazy-relations/">Eager and Lazy Relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../embedded-entities/">Embedded Entities</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../entities/">Entities</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../entity-inheritance/">Entity Inheritance</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../entity-manager-api/">`EntityManager` API</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../entity-metadata/">Entity Metadata</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../example-with-express/">Example using TypeORM with Express</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../find-options/">Find Options</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../indices/">Indices</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../insert-query-builder/">Insert using Query Builder</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../internals/">Internals</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../listeners-and-subscribers/">Entity Listeners and Subscribers</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logging/">Logging</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../many-to-many-relations/">Many-to-many relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../many-to-one-one-to-many-relations/">Many-to-one / one-to-many relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../migrations/">Migrations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../mongodb/">MongoDB</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../multiple-connections/">Multiple connections, databases, schemas and replication setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../naming-strategy/">Naming strategy</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../one-to-one-relations/">One-to-one relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../query-runner/">Working with Query Runner</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../relational-query-builder/">Working with Relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../relations-faq/">Relations FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../relations/">Relations</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Repository APIs</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#repository-api">Repository API</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#additional-options">Additional Options</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#treerepository-api">TreeRepository API</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#mongorepository-api">MongoRepository API</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../roadmap/">Roadmap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../select-query-builder/">Select using Query Builder</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../separating-entity-definition/">Separating Entity Definition</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../sequelize-migration/">Migration from Sequelize to TypeORM</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../support/">Support</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../supported-platforms/">Supported platforms</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../transactions/">Transactions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tree-entities/">Tree Entities</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../update-query-builder/">Update using Query Builder</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../usage-with-javascript/">Using with JavaScript</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../using-cli/">Using CLI</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../using-ormconfig/">Using Configuration Sources</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../validation/">Using Validation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../view-entities/">View Entities</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../working-with-entity-manager/">What is EntityManager</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../working-with-repository/">What is Repository</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">TypeORM 0.2.38</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>Repository APIs</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="repository-apis">Repository APIs</h1>
<ul>
<li><a href="#repository-api">Repository API</a></li>
<li><a href="#treerepository-api">TreeRepository API</a></li>
<li><a href="#mongorepository-api">MongoRepository API</a></li>
</ul>
<h2 id="repository-api"><code>Repository</code> API</h2>
<ul>
<li><code>manager</code> - The <code>EntityManager</code> used by this repository.</li>
</ul>
<pre><code class="language-typescript">const manager = repository.manager;
</code></pre>
<ul>
<li><code>metadata</code> - The <code>EntityMetadata</code> of the entity managed by this repository.
Learn more about <a href="../entity-metadata/">transactions in Entity Metadata</a>.</li>
</ul>
<pre><code class="language-typescript">const metadata = repository.metadata;
</code></pre>
<ul>
<li><code>queryRunner</code> - The query runner used by <code>EntityManager</code>.
Used only in transactional instances of EntityManager.</li>
</ul>
<pre><code class="language-typescript">const queryRunner = repository.queryRunner;
</code></pre>
<ul>
<li><code>target</code> - The target entity class managed by this repository.
Used only in transactional instances of EntityManager.</li>
</ul>
<pre><code class="language-typescript">const target = repository.target;
</code></pre>
<ul>
<li><code>createQueryBuilder</code> - Creates a query builder use to build SQL queries.
Learn more about <a href="../select-query-builder/">QueryBuilder</a>.</li>
</ul>
<pre><code class="language-typescript">const users = await repository
    .createQueryBuilder(&quot;user&quot;)
    .where(&quot;user.name = :name&quot;, { name: &quot;John&quot; })
    .getMany();
</code></pre>
<ul>
<li><code>hasId</code> - Checks if the given entity's primary column property is defined.</li>
</ul>
<pre><code class="language-typescript"> if (repository.hasId(user)) {
    // ... do something
 }
</code></pre>
<ul>
<li><code>getId</code> - Gets the primary column property values of the given entity.
If entity has composite primary keys then the returned value will be an object with names and values of primary columns.</li>
</ul>
<pre><code class="language-typescript">const userId = repository.getId(user); // userId === 1
</code></pre>
<ul>
<li><code>create</code> - Creates a new instance of <code>User</code>. Optionally accepts an object literal with user properties
which will be written into newly created user object</li>
</ul>
<pre><code class="language-typescript">const user = repository.create(); // same as const user = new User();
const user = repository.create({
    id: 1,
    firstName: &quot;Timber&quot;,
    lastName: &quot;Saw&quot;
}); // same as const user = new User(); user.firstName = &quot;Timber&quot;; user.lastName = &quot;Saw&quot;;
</code></pre>
<ul>
<li><code>merge</code> - Merges multiple entities into a single entity.</li>
</ul>
<pre><code class="language-typescript">const user = new User();
repository.merge(user, { firstName: &quot;Timber&quot; }, { lastName: &quot;Saw&quot; }); // same as user.firstName = &quot;Timber&quot;; user.lastName = &quot;Saw&quot;;
</code></pre>
<ul>
<li><code>preload</code> - Creates a new entity from the given plain javascript object. If the entity already exists in the database, then
it loads it (and everything related to it), replaces all values with the new ones from the given object,
and returns the new entity. The new entity is actually an entity loaded from the database with all properties
replaced from the new object. <br>
Note that given entity-like object must have an entity id / primary key to find entity by.
Returns undefined if entity with given id was not found.</li>
</ul>
<pre><code class="language-typescript">const partialUser = {
    id: 1,
    firstName: &quot;Rizzrak&quot;,
    profile: {
        id: 1
    }
};
const user = await repository.preload(partialUser);
// user will contain all missing data from partialUser with partialUser property values:
// { id: 1, firstName: &quot;Rizzrak&quot;, lastName: &quot;Saw&quot;, profile: { id: 1, ... } }
</code></pre>
<ul>
<li><code>save</code> - Saves a given entity or array of entities.
If the entity already exist in the database, it is updated.
If the entity does not exist in the database, it is inserted.
It saves all given entities in a single transaction (in the case of entity, manager is not transactional).
Also supports partial updating since all undefined properties are skipped.
Returns the saved entity/entities.</li>
</ul>
<pre><code class="language-typescript">await repository.save(user);
await repository.save([
    category1,
    category2,
    category3
]);
</code></pre>
<ul>
<li><code>remove</code> - Removes a given entity or array of entities.
It removes all given entities in a single transaction (in the case of entity, manager is not transactional).
Returns the removed entity/entities.</li>
</ul>
<pre><code class="language-typescript">await repository.remove(user);
await repository.remove([
    category1,
    category2,
    category3
]);
</code></pre>
<ul>
<li><code>insert</code> - Inserts a new entity, or array of entities.</li>
</ul>
<pre><code class="language-typescript">await repository.insert({
    firstName: &quot;Timber&quot;,
    lastName: &quot;Timber&quot;
});


await manager.insert(User, [{
    firstName: &quot;Foo&quot;,
    lastName: &quot;Bar&quot;
}, {
    firstName: &quot;Rizz&quot;,
    lastName: &quot;Rak&quot;
}]);
</code></pre>
<ul>
<li><code>update</code> - Partially updates entity by a given update options or entity id.</li>
</ul>
<pre><code class="language-typescript">await repository.update({ firstName: &quot;Timber&quot; }, { firstName: &quot;Rizzrak&quot; });
// executes UPDATE user SET firstName = Rizzrak WHERE firstName = Timber

await repository.update(1, { firstName: &quot;Rizzrak&quot; });
// executes UPDATE user SET firstName = Rizzrak WHERE id = 1
</code></pre>
<ul>
<li><code>delete</code> - Deletes entities by entity id, ids or given conditions:</li>
</ul>
<pre><code class="language-typescript">await repository.delete(1);
await repository.delete([1, 2, 3]);
await repository.delete({ firstName: &quot;Timber&quot; });
</code></pre>
<ul>
<li><code>softDelete</code> and <code>restore</code> - Soft deleting and restoring a row by id</li>
</ul>
<pre><code class="language-typescript">const repository = connection.getRepository(Entity);
// Delete a entity
await repository.softDelete(1);
// And You can restore it using restore;
await repository.restore(1);
</code></pre>
<ul>
<li><code>softRemove</code> and <code>recover</code> - This is alternative to <code>softDelete</code> and <code>restore</code>.</li>
</ul>
<pre><code class="language-typescript">// You can soft-delete them using softRemove
const entities = await repository.find();
const entitiesAfterSoftRemove = await repository.softRemove(entities);

// And You can recover them using recover;
await repository.recover(entitiesAfterSoftRemove);
</code></pre>
<ul>
<li><code>count</code> - Counts entities that match given options. Useful for pagination.</li>
</ul>
<pre><code class="language-typescript">const count = await repository.count({ firstName: &quot;Timber&quot; });
</code></pre>
<ul>
<li><code>increment</code> - Increments some column by provided value of entities that match given options.</li>
</ul>
<pre><code class="language-typescript">await manager.increment(User, { firstName: &quot;Timber&quot; }, &quot;age&quot;, 3);
</code></pre>
<ul>
<li><code>decrement</code> - Decrements some column by provided value that match given options.</li>
</ul>
<pre><code class="language-typescript">await manager.decrement(User, { firstName: &quot;Timber&quot; }, &quot;age&quot;, 3);
</code></pre>
<ul>
<li><code>find</code> - Finds entities that match given options.</li>
</ul>
<pre><code class="language-typescript">const timbers = await repository.find({ firstName: &quot;Timber&quot; });
</code></pre>
<ul>
<li><code>findAndCount</code> - Finds entities that match given find options.
Also counts all entities that match given conditions,
but ignores pagination settings (<code>skip</code> and <code>take</code> options).</li>
</ul>
<pre><code class="language-typescript">const [timbers, timbersCount] = await repository.findAndCount({ firstName: &quot;Timber&quot; });
</code></pre>
<ul>
<li><code>findByIds</code> - Finds multiple entities by id.</li>
</ul>
<pre><code class="language-typescript">const users = await repository.findByIds([1, 2, 3]);
</code></pre>
<ul>
<li><code>findOne</code> - Finds first entity that matches some id or find options.</li>
</ul>
<pre><code class="language-typescript">const user = await repository.findOne(1);
const timber = await repository.findOne({ firstName: &quot;Timber&quot; });
</code></pre>
<ul>
<li><code>findOneOrFail</code> - Finds the first entity that matches the some id or find options.
Rejects the returned promise if nothing matches.</li>
</ul>
<pre><code class="language-typescript">const user = await repository.findOneOrFail(1);
const timber = await repository.findOneOrFail({ firstName: &quot;Timber&quot; });
</code></pre>
<blockquote>
<p>Note: It is strongly recommended to ensure that your <code>id</code> or <code>FindOptions</code> value is not <code>null</code> or <code>undefined</code> before calling <code>findOne</code> and <code>findOneOrFail</code>. When passed <code>null</code> or <code>undefined</code>, the query will match with every entity in the repository and return the first record.</p>
</blockquote>
<ul>
<li><code>query</code> - Executes a raw SQL query.</li>
</ul>
<pre><code class="language-typescript">const rawData = await repository.query(`SELECT * FROM USERS`);
</code></pre>
<ul>
<li><code>clear</code> - Clears all the data from the given table (truncates/drops it).</li>
</ul>
<pre><code class="language-typescript">await repository.clear();
</code></pre>
<h3 id="additional-options">Additional Options</h3>
<p>Optional <code>SaveOptions</code> can be passed as parameter for <code>save</code>.</p>
<ul>
<li><code>data</code> -  Additional data to be passed with persist method. This data can be used in subscribers then.</li>
<li><code>listeners</code>: boolean - Indicates if listeners and subscribers are called for this operation. By default they are enabled, you can disable them by setting <code>{ listeners: false }</code> in save/remove options.</li>
<li><code>transaction</code>: boolean - By default transactions are enabled and all queries in persistence operation are wrapped into the transaction. You can disable this behaviour by setting <code>{ transaction: false }</code> in the persistence options.</li>
<li><code>chunk</code>: number - Breaks save execution into multiple groups of chunks. For example, if you want to save 100.000 objects but you have issues with saving them, you can break them into 10 groups of 10.000 objects (by setting <code>{ chunk: 10000 }</code>) and save each group separately. This option is needed to perform very big insertions when you have issues with underlying driver parameter number limitation.</li>
<li><code>reload</code>: boolean - Flag to determine whether the entity that is being persisted should be reloaded during the persistence operation. It will work only on databases which does not support RETURNING / OUTPUT statement. Enabled by default.</li>
</ul>
<p>Example:</p>
<pre><code class="language-typescript">// users contains array of User Entities
userRepository.save(users, {chunk: users.length / 1000});
</code></pre>
<p>Optional <code>RemoveOptions</code> can be passed as parameter for <code>remove</code> and <code>delete</code>.</p>
<ul>
<li><code>data</code> - Additional data to be passed with remove method. This data can be used in subscribers then.</li>
<li><code>listener</code>: boolean - Indicates if listeners and subscribers are called for this operation. By default they are enabled, you can disable them by setting <code>{ listeners: false }</code> in save/remove options.</li>
<li><code>transaction</code>: boolean - By default transactions are enabled and all queries in persistence operation are wrapped into the transaction. You can disable this behaviour by setting <code>{ transaction: false }</code> in the persistence options.</li>
<li><code>chunk</code>: number - Breaks save execution into multiple groups of chunks. For example, if you want to save 100.000 objects but you have issues saving them, you can break them into 10 groups of 10.000 objects, by setting <code>{ chunk: 10000 }</code>, and save each group separately. This option is needed to perform very big insertions when you have issues with underlying driver parameter number limitation.</li>
</ul>
<p>Example:</p>
<pre><code class="language-typescript">// users contains array of User Entities
userRepository.remove(users, {chunk: entities.length / 1000});
</code></pre>
<h2 id="treerepository-api"><code>TreeRepository</code> API</h2>
<p>For <code>TreeRepository</code> API refer to <a href="../tree-entities/#working-with-tree-entities">the Tree Entities documentation</a>.</p>
<h2 id="mongorepository-api"><code>MongoRepository</code> API</h2>
<p>For <code>MongoRepository</code> API refer to <a href="../mongodb/">the MongoDB documentation</a>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../relations/" class="btn btn-neutral float-left" title="Relations"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../roadmap/" class="btn btn-neutral float-right" title="Roadmap">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../relations/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../roadmap/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
