<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://typeorm-legacy.productsway.com/connection/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Working with Connection - TypeORM 0.2.38</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Working with Connection";
        var mkdocs_page_input_path = "connection.md";
        var mkdocs_page_url = "/connection/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> TypeORM 0.2.38
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Documentation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../active-record-data-mapper/">Active Record vs Data Mapper</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../caching/">Caching queries</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../connection-api/">Connection APIs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../connection-options/">Connection Options</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Working with Connection</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#what-is-connection">What is Connection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#creating-a-new-connection">Creating a new connection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-connectionmanager">Using ConnectionManager</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#working-with-connection_1">Working with connection</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../custom-repository/">Custom repositories</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../decorator-reference/">Decorators reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../delete-query-builder/">Delete using Query Builder</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../eager-and-lazy-relations/">Eager and Lazy Relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../embedded-entities/">Embedded Entities</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../entities/">Entities</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../entity-inheritance/">Entity Inheritance</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../entity-manager-api/">`EntityManager` API</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../entity-metadata/">Entity Metadata</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../example-with-express/">Example using TypeORM with Express</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../find-options/">Find Options</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../indices/">Indices</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../insert-query-builder/">Insert using Query Builder</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../internals/">Internals</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../listeners-and-subscribers/">Entity Listeners and Subscribers</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logging/">Logging</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../many-to-many-relations/">Many-to-many relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../many-to-one-one-to-many-relations/">Many-to-one / one-to-many relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../migrations/">Migrations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../mongodb/">MongoDB</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../multiple-connections/">Multiple connections, databases, schemas and replication setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../naming-strategy/">Naming strategy</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../one-to-one-relations/">One-to-one relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../query-runner/">Working with Query Runner</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../relational-query-builder/">Working with Relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../relations-faq/">Relations FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../relations/">Relations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../repository-api/">Repository APIs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../roadmap/">Roadmap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../select-query-builder/">Select using Query Builder</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../separating-entity-definition/">Separating Entity Definition</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../sequelize-migration/">Migration from Sequelize to TypeORM</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../support/">Support</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../supported-platforms/">Supported platforms</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../transactions/">Transactions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tree-entities/">Tree Entities</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../update-query-builder/">Update using Query Builder</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../usage-with-javascript/">Using with JavaScript</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../using-cli/">Using CLI</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../using-ormconfig/">Using Configuration Sources</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../validation/">Using Validation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../view-entities/">View Entities</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../working-with-entity-manager/">What is EntityManager</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../working-with-repository/">What is Repository</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">TypeORM 0.2.38</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>Working with Connection</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="working-with-connection">Working with Connection</h1>
<ul>
<li><a href="#what-is-connection">What is <code>Connection</code></a></li>
<li><a href="#creating-a-new-connection">Creating a new connection</a></li>
<li><a href="#using-connectionmanager">Using <code>ConnectionManager</code></a></li>
<li><a href="#working-with-connection">Working with connection</a></li>
</ul>
<h2 id="what-is-connection">What is <code>Connection</code></h2>
<p>Your interaction with the database is only possible once you setup a connection.
TypeORM's <code>Connection</code> does not setup a database connection as it might seem, instead it sets up a connection pool.
If you are interested in a real database connection, then refer to <code>QueryRunner</code> documentation.
Each instance of <code>QueryRunner</code> is a separate isolated database connection.
Connection pool setup is established once <code>connect</code> method of the <code>Connection</code> is called.
<code>connect</code> method is called automatically if you setup your connection using <code>createConnection</code> function.
Disconnection (closing all connections in the pool) is made when <code>close</code> is called.
Generally, you must create connection only once in your application bootstrap,
and close it after you completely finished working with the database.
In practice, if you are building a backend for your site and your backend server always stays running -
you never close a connection.</p>
<h2 id="creating-a-new-connection">Creating a new connection</h2>
<p>There are several ways how a connection can be created.
The most simple and common way is to use <code>createConnection</code> and <code>createConnections</code> functions.</p>
<p><code>createConnection</code> creates a single connection:</p>
<pre><code class="language-typescript">import {createConnection, Connection} from &quot;typeorm&quot;;

const connection = await createConnection({
    type: &quot;mysql&quot;,
    host: &quot;localhost&quot;,
    port: 3306,
    username: &quot;test&quot;,
    password: &quot;test&quot;,
    database: &quot;test&quot;
});
</code></pre>
<p>A single <code>url</code> attribute, plus the <code>type</code> attribute, will work too.</p>
<pre><code class="language-js">createConnection({
    type: 'postgres',
    url: 'postgres://test:test@localhost/test'
})
</code></pre>
<p><code>createConnections</code> creates multiple connections:</p>
<pre><code class="language-typescript">import {createConnections, Connection} from &quot;typeorm&quot;;

const connections = await createConnections([{
    name: &quot;default&quot;,
    type: &quot;mysql&quot;,
    host: &quot;localhost&quot;,
    port: 3306,
    username: &quot;test&quot;,
    password: &quot;test&quot;,
    database: &quot;test&quot;
}, {
    name: &quot;test2-connection&quot;,
    type: &quot;mysql&quot;,
    host: &quot;localhost&quot;,
    port: 3306,
    username: &quot;test&quot;,
    password: &quot;test&quot;,
    database: &quot;test2&quot;
}]);
</code></pre>
<p>Both these functions create <code>Connection</code> based on connection options you pass and call a <code>connect</code> method.
You can create <a href="../using-ormconfig/">ormconfig.json</a> file in the root of your project
and connection options will be automatically read from this file by those methods.
Root of your project is the same level where your <code>node_modules</code> directory is.</p>
<pre><code class="language-typescript">import {createConnection, createConnections, Connection} from &quot;typeorm&quot;;

// here createConnection will load connection options from
// ormconfig.json / ormconfig.js / ormconfig.yml / ormconfig.env / ormconfig.xml
// files, or from special environment variables
const connection: Connection = await createConnection();

// you can specify the name of the connection to create
// (if you omit name it will create a connection without name specified)
const secondConnection: Connection = await createConnection(&quot;test2-connection&quot;);

// if createConnections is called instead of createConnection then
// it will initialize and return all connections defined in ormconfig file
const connections: Connection[] = await createConnections();
</code></pre>
<p>Different connections must have different names.
By default, if connection name is not specified it's equal to <code>default</code>.
Usually, you use multiple connections when you use multiple databases or multiple connection configurations.</p>
<p>Once you created a connection you can obtain it anywhere from your app, using <code>getConnection</code> function:</p>
<pre><code class="language-typescript">import {getConnection} from &quot;typeorm&quot;;

// can be used once createConnection is called and is resolved
const connection = getConnection();

// if you have multiple connections you can get connection by name
const secondConnection = getConnection(&quot;test2-connection&quot;);
</code></pre>
<p>Avoid creating extra classes / services to store and manage your connections.
This functionality is already embedded into TypeORM -
you don't need to overengineer and create useless abstractions.</p>
<h2 id="using-connectionmanager">Using <code>ConnectionManager</code></h2>
<p>You can create connection using <code>ConnectionManager</code> class. For example:</p>
<pre><code class="language-typescript">import {getConnectionManager, ConnectionManager, Connection} from &quot;typeorm&quot;;

const connectionManager = getConnectionManager();
const connection = connectionManager.create({
    type: &quot;mysql&quot;,
    host: &quot;localhost&quot;,
    port: 3306,
    username: &quot;test&quot;,
    password: &quot;test&quot;,
    database: &quot;test&quot;,
});
await connection.connect(); // performs connection
</code></pre>
<p>This is not a general way of creating a connection, but it may be useful for some users.
For example, users who want to create connection and store its instance,
but have to control when the actual "connection" will be established.
Also you can create and maintain your own <code>ConnectionManager</code>:</p>
<pre><code class="language-typescript">import {getConnectionManager, ConnectionManager, Connection} from &quot;typeorm&quot;;

const connectionManager = new ConnectionManager();
const connection = connectionManager.create({
    type: &quot;mysql&quot;,
    host: &quot;localhost&quot;,
    port: 3306,
    username: &quot;test&quot;,
    password: &quot;test&quot;,
    database: &quot;test&quot;,
});
await connection.connect(); // performs connection
</code></pre>
<p>But note, this way you won't be able to use <code>getConnection()</code> anymore -
you'll need to store your connection manager instance and use <code>connectionManager.get</code> to get a connection you need.</p>
<p>Generally avoid this method and avoid unnecessary complications in your application,
use <code>ConnectionManager</code> only if you really think you need it.</p>
<h2 id="working-with-connection_1">Working with connection</h2>
<p>Once you set your connection up, you can use it anywhere in your app using <code>getConnection</code> function:</p>
<pre><code class="language-typescript">import {getConnection} from &quot;typeorm&quot;;
import {User} from &quot;../entity/User&quot;;

export class UserController {

    @Get(&quot;/users&quot;)
    getAll() {
        return getConnection().manager.find(User);
    }

}
</code></pre>
<p>You can also use <code>ConnectionManager#get</code> to get a connection,
but using <code>getConnection()</code> is enough in most cases.</p>
<p>Using Connection you execute database operations with your entities,
particularly using connection's <code>EntityManager</code> and <code>Repository</code>.
For more information about them see <a href="../working-with-entity-manager/">Entity Manager and Repository</a> documentation.</p>
<p>But generally, you don't use <code>Connection</code> much.
Most of the time you only create a connection and use <code>getRepository()</code> and <code>getManager()</code>
to access your connection's manager and repositories without directly using connection object:</p>
<pre><code class="language-typescript">import {getManager, getRepository} from &quot;typeorm&quot;;
import {User} from &quot;../entity/User&quot;;

export class UserController {

    @Get(&quot;/users&quot;)
    getAll() {
        return getManager().find(User);
    }

    @Get(&quot;/users/:id&quot;)
    getAll(@Param(&quot;id&quot;) userId: number) {
        return getRepository(User).findOne(userId);
    }

}
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../connection-options/" class="btn btn-neutral float-left" title="Connection Options"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../custom-repository/" class="btn btn-neutral float-right" title="Custom repositories">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../connection-options/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../custom-repository/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
